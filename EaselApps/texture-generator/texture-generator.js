    var timeout = null;
    var textures = JSON.parse(textures_json);
    var targetVolume;
    
    var getSelectedVolumes = function(volumes, selectedVolumeIds) {
      var selectedVolumes = [];
      var volume;
      for (var i = 0; i < volumes.length; i++) {
        volume = volumes[i];
        if (selectedVolumeIds.indexOf(volume.id) !== -1) {
          selectedVolumes.push(volume);
        }
      }
      return selectedVolumes;
    };
    
    //var pathData = 'M -1.121002197265625 -2.1199951171875 C -1.121002197265625 -2.1199951171875 -1.21868896484375 -2.20733642578125 -1.21868896484375 -2.20733642578125 C -1.21868896484375 -2.20733642578125 -1.319854736328125 -2.28985595703125 -1.319854736328125 -2.28985595703125 C -1.319854736328125 -2.28985595703125 -1.42431640625 -2.367462158203125 -1.42431640625 -2.367462158203125 C -1.42431640625 -2.367462158203125 -1.53192138671875 -2.440155029296875 -1.53192138671875 -2.440155029296875 C -1.53192138671875 -2.440155029296875 -1.642425537109375 -2.507781982421875 -1.642425537109375 -2.507781982421875 C -1.642425537109375 -2.507781982421875 -1.755706787109375 -2.5703125 -1.755706787109375 -2.5703125 C -1.755706787109375 -2.5703125 -1.871551513671875 -2.627655029296875 -1.871551513671875 -2.627655029296875 C -1.871551513671875 -2.627655029296875 -1.98980712890625 -2.67974853515625 -1.98980712890625 -2.67974853515625 C -1.98980712890625 -2.67974853515625 -2.110260009765625 -2.72650146484375 -2.110260009765625 -2.72650146484375 C -2.110260009765625 -2.72650146484375 -2.23272705078125 -2.767822265625 -2.23272705078125 -2.767822265625 C -2.23272705078125 -2.767822265625 -2.3570556640625 -2.803680419921875 -2.3570556640625 -2.803680419921875 C -2.3570556640625 -2.803680419921875 -2.4830322265625 -2.833953857421875 -2.4830322265625 -2.833953857421875 C -2.4830322265625 -2.833953857421875 -2.610504150390625 -2.858612060546875 -2.610504150390625 -2.858612060546875 C -2.610504150390625 -2.858612060546875 -2.739288330078125 -2.8775634765625 -2.739288330078125 -2.8775634765625 C -2.739288330078125 -2.8775634765625 -2.869171142578125 -2.890716552734375 -2.869171142578125 -2.890716552734375 C -2.869171142578125 -2.890716552734375 -3 -2.89801025390625 -3 -2.89801025390625 C -3 -2.89801025390625 -3 -3 -3 -3 C -3 -3 -2.316009521484375 -3 -2.316009521484375 -3 C -2.316009521484375 -3 -2.2244873046875 -2.979583740234375 -2.2244873046875 -2.979583740234375 C -2.2244873046875 -2.979583740234375 -2.133819580078125 -2.9564208984375 -2.133819580078125 -2.9564208984375 C -2.133819580078125 -2.9564208984375 -2.043975830078125 -2.93060302734375 -2.043975830078125 -2.93060302734375 C -2.043975830078125 -2.93060302734375 -1.955078125 -2.902099609375 -1.955078125 -2.902099609375 C -1.955078125 -2.902099609375 -1.867156982421875 -2.870941162109375 -1.867156982421875 -2.870941162109375 C -1.867156982421875 -2.870941162109375 -1.780242919921875 -2.837188720703125 -1.780242919921875 -2.837188720703125 C -1.780242919921875 -2.837188720703125 -1.6944580078125 -2.80084228515625 -1.6944580078125 -2.80084228515625 C -1.6944580078125 -2.80084228515625 -1.60980224609375 -2.761962890625 -1.60980224609375 -2.761962890625 C -1.60980224609375 -2.761962890625 -1.5263671875 -2.72052001953125 -1.5263671875 -2.72052001953125 C -1.5263671875 -2.72052001953125 -1.4442138671875 -2.676605224609375 -1.4442138671875 -2.676605224609375 C -1.4442138671875 -2.676605224609375 -1.363372802734375 -2.63018798828125 -1.363372802734375 -2.63018798828125 C -1.363372802734375 -2.63018798828125 -1.283905029296875 -2.581329345703125 -1.283905029296875 -2.581329345703125 C -1.283905029296875 -2.581329345703125 -1.20587158203125 -2.530059814453125 -1.20587158203125 -2.530059814453125 C -1.20587158203125 -2.530059814453125 -1.12933349609375 -2.476409912109375 -1.12933349609375 -2.476409912109375 C -1.12933349609375 -2.476409912109375 -1.054351806640625 -2.420379638671875 -1.054351806640625 -2.420379638671875 C -1.054351806640625 -2.420379638671875 -0.980987548828125 -2.36199951171875 -0.980987548828125 -2.36199951171875 C -0.980987548828125 -2.36199951171875 -0.3438720703125 -3 -0.3438720703125 -3 C -0.3438720703125 -3 0.040008544921875 -3 0.040008544921875 -3 C 0.040008544921875 -3 0.77899169921875 -2.260009765625 0.77899169921875 -2.260009765625 C 0.77899169921875 -2.260009765625 0.850616455078125 -2.325286865234375 0.850616455078125 -2.325286865234375 C 0.850616455078125 -2.325286865234375 0.924102783203125 -2.388214111328125 0.924102783203125 -2.388214111328125 C 0.924102783203125 -2.388214111328125 0.999420166015625 -2.44873046875 0.999420166015625 -2.44873046875 C 0.999420166015625 -2.44873046875 1.07647705078125 -2.50677490234375 1.07647705078125 -2.50677490234375 C 1.07647705078125 -2.50677490234375 1.155242919921875 -2.562347412109375 1.155242919921875 -2.562347412109375 C 1.155242919921875 -2.562347412109375 1.23565673828125 -2.615386962890625 1.23565673828125 -2.615386962890625 C 1.23565673828125 -2.615386962890625 1.317626953125 -2.6658935546875 1.317626953125 -2.6658935546875 C 1.317626953125 -2.6658935546875 1.401123046875 -2.71380615234375 1.401123046875 -2.71380615234375 C 1.401123046875 -2.71380615234375 1.486053466796875 -2.759124755859375 1.486053466796875 -2.759124755859375 C 1.486053466796875 -2.759124755859375 1.572357177734375 -2.8017578125 1.572357177734375 -2.8017578125 C 1.572357177734375 -2.8017578125 1.660003662109375 -2.841705322265625 1.660003662109375 -2.841705322265625 C 1.660003662109375 -2.841705322265625 1.748931884765625 -2.878936767578125 1.748931884765625 -2.878936767578125 C 1.748931884765625 -2.878936767578125 1.83905029296875 -2.913421630859375 1.83905029296875 -2.913421630859375 C 1.83905029296875 -2.913421630859375 1.9302978515625 -2.94512939453125 1.9302978515625 -2.94512939453125 C 1.9302978515625 -2.94512939453125 2.02264404296875 -2.9739990234375 2.02264404296875 -2.9739990234375 C 2.02264404296875 -2.9739990234375 2.115997314453125 -3 2.115997314453125 -3 C 2.115997314453125 -3 3 -3 3 -3 C 3 -3 3 3 3 3 C 3 3 2.115997314453125 3 2.115997314453125 3 C 2.115997314453125 3 2.02264404296875 2.9739990234375 2.02264404296875 2.9739990234375 C 2.02264404296875 2.9739990234375 1.9302978515625 2.94512939453125 1.9302978515625 2.94512939453125 C 1.9302978515625 2.94512939453125 1.83905029296875 2.913421630859375 1.83905029296875 2.913421630859375 C 1.83905029296875 2.913421630859375 1.748931884765625 2.878936767578125 1.748931884765625 2.878936767578125 C 1.748931884765625 2.878936767578125 1.660003662109375 2.841705322265625 1.660003662109375 2.841705322265625 C 1.660003662109375 2.841705322265625 1.572357177734375 2.8017578125 1.572357177734375 2.8017578125 C 1.572357177734375 2.8017578125 1.486053466796875 2.759124755859375 1.486053466796875 2.759124755859375 C 1.486053466796875 2.759124755859375 1.401123046875 2.71380615234375 1.401123046875 2.71380615234375 C 1.401123046875 2.71380615234375 1.317626953125 2.6658935546875 1.317626953125 2.6658935546875 C 1.317626953125 2.6658935546875 1.23565673828125 2.615386962890625 1.23565673828125 2.615386962890625 C 1.23565673828125 2.615386962890625 1.155242919921875 2.562347412109375 1.155242919921875 2.562347412109375 C 1.155242919921875 2.562347412109375 1.07647705078125 2.50677490234375 1.07647705078125 2.50677490234375 C 1.07647705078125 2.50677490234375 0.999420166015625 2.44873046875 0.999420166015625 2.44873046875 C 0.999420166015625 2.44873046875 0.924102783203125 2.388214111328125 0.924102783203125 2.388214111328125 C 0.924102783203125 2.388214111328125 0.850616455078125 2.325286865234375 0.850616455078125 2.325286865234375 C 0.850616455078125 2.325286865234375 0.77899169921875 2.260009765625 0.77899169921875 2.260009765625 C 0.77899169921875 2.260009765625 0.040008544921875 3 0.040008544921875 3 C 0.040008544921875 3 -0.3438720703125 3 -0.3438720703125 3 C -0.3438720703125 3 -0.980987548828125 2.36199951171875 -0.980987548828125 2.36199951171875 C -0.980987548828125 2.36199951171875 -1.054351806640625 2.420379638671875 -1.054351806640625 2.420379638671875 C -1.054351806640625 2.420379638671875 -1.12933349609375 2.476409912109375 -1.12933349609375 2.476409912109375 C -1.12933349609375 2.476409912109375 -1.20587158203125 2.530059814453125 -1.20587158203125 2.530059814453125 C -1.20587158203125 2.530059814453125 -1.283905029296875 2.581329345703125 -1.283905029296875 2.581329345703125 C -1.283905029296875 2.581329345703125 -1.363372802734375 2.63018798828125 -1.363372802734375 2.63018798828125 C -1.363372802734375 2.63018798828125 -1.4442138671875 2.676605224609375 -1.4442138671875 2.676605224609375 C -1.4442138671875 2.676605224609375 -1.5263671875 2.72052001953125 -1.5263671875 2.72052001953125 C -1.5263671875 2.72052001953125 -1.60980224609375 2.761962890625 -1.60980224609375 2.761962890625 C -1.60980224609375 2.761962890625 -1.6944580078125 2.80084228515625 -1.6944580078125 2.80084228515625 C -1.6944580078125 2.80084228515625 -1.780242919921875 2.837188720703125 -1.780242919921875 2.837188720703125 C -1.780242919921875 2.837188720703125 -1.867156982421875 2.870941162109375 -1.867156982421875 2.870941162109375 C -1.867156982421875 2.870941162109375 -1.955078125 2.902099609375 -1.955078125 2.902099609375 C -1.955078125 2.902099609375 -2.043975830078125 2.93060302734375 -2.043975830078125 2.93060302734375 C -2.043975830078125 2.93060302734375 -2.133819580078125 2.9564208984375 -2.133819580078125 2.9564208984375 C -2.133819580078125 2.9564208984375 -2.2244873046875 2.979583740234375 -2.2244873046875 2.979583740234375 C -2.2244873046875 2.979583740234375 -2.316009521484375 3 -2.316009521484375 3 C -2.316009521484375 3 -3 3 -3 3 C -3 3 -3 2.89801025390625 -3 2.89801025390625 C -3 2.89801025390625 -2.869171142578125 2.890716552734375 -2.869171142578125 2.890716552734375 C -2.869171142578125 2.890716552734375 -2.739288330078125 2.8775634765625 -2.739288330078125 2.8775634765625 C -2.739288330078125 2.8775634765625 -2.610504150390625 2.858612060546875 -2.610504150390625 2.858612060546875 C -2.610504150390625 2.858612060546875 -2.4830322265625 2.833953857421875 -2.4830322265625 2.833953857421875 C -2.4830322265625 2.833953857421875 -2.3570556640625 2.803680419921875 -2.3570556640625 2.803680419921875 C -2.3570556640625 2.803680419921875 -2.23272705078125 2.767822265625 -2.23272705078125 2.767822265625 C -2.23272705078125 2.767822265625 -2.110260009765625 2.72650146484375 -2.110260009765625 2.72650146484375 C -2.110260009765625 2.72650146484375 -1.98980712890625 2.67974853515625 -1.98980712890625 2.67974853515625 C -1.98980712890625 2.67974853515625 -1.871551513671875 2.627655029296875 -1.871551513671875 2.627655029296875 C -1.871551513671875 2.627655029296875 -1.755706787109375 2.5703125 -1.755706787109375 2.5703125 C -1.755706787109375 2.5703125 -1.642425537109375 2.507781982421875 -1.642425537109375 2.507781982421875 C -1.642425537109375 2.507781982421875 -1.53192138671875 2.440155029296875 -1.53192138671875 2.440155029296875 C -1.53192138671875 2.440155029296875 -1.42431640625 2.367462158203125 -1.42431640625 2.367462158203125 C -1.42431640625 2.367462158203125 -1.319854736328125 2.28985595703125 -1.319854736328125 2.28985595703125 C -1.319854736328125 2.28985595703125 -1.21868896484375 2.20733642578125 -1.21868896484375 2.20733642578125 C -1.21868896484375 2.20733642578125 -1.121002197265625 2.1199951171875 -1.121002197265625 2.1199951171875 C -1.121002197265625 2.1199951171875 -3 0.240997314453125 -3 0.240997314453125 C -3 0.240997314453125 -3 -0.240997314453125 -3 -0.240997314453125 C -3 -0.240997314453125 -1.121002197265625 -2.1199951171875 -1.121002197265625 -2.1199951171875 M 0.920013427734375 2.118988037109375 C 0.920013427734375 2.118988037109375 0.920013427734375 2.1199951171875 0.920013427734375 2.1199951171875 C 0.920013427734375 2.1199951171875 1.017669677734375 2.207489013671875 1.017669677734375 2.207489013671875 C 1.017669677734375 2.207489013671875 1.118865966796875 2.290191650390625 1.118865966796875 2.290191650390625 C 1.118865966796875 2.290191650390625 1.223358154296875 2.36798095703125 1.223358154296875 2.36798095703125 C 1.223358154296875 2.36798095703125 1.330963134765625 2.440826416015625 1.330963134765625 2.440826416015625 C 1.330963134765625 2.440826416015625 1.4415283203125 2.50860595703125 1.4415283203125 2.50860595703125 C 1.4415283203125 2.50860595703125 1.554840087890625 2.5712890625 1.554840087890625 2.5712890625 C 1.554840087890625 2.5712890625 1.670745849609375 2.628753662109375 1.670745849609375 2.628753662109375 C 1.670745849609375 2.628753662109375 1.7890625 2.68096923828125 1.7890625 2.68096923828125 C 1.7890625 2.68096923828125 1.909576416015625 2.72784423828125 1.909576416015625 2.72784423828125 C 1.909576416015625 2.72784423828125 2.032135009765625 2.769317626953125 2.032135009765625 2.769317626953125 C 2.032135009765625 2.769317626953125 2.15655517578125 2.805267333984375 2.15655517578125 2.805267333984375 C 2.15655517578125 2.805267333984375 2.282623291015625 2.835662841796875 2.282623291015625 2.835662841796875 C 2.282623291015625 2.835662841796875 2.410186767578125 2.86041259765625 2.410186767578125 2.86041259765625 C 2.410186767578125 2.86041259765625 2.5390625 2.879425048828125 2.5390625 2.879425048828125 C 2.5390625 2.879425048828125 2.6690673828125 2.89263916015625 2.6690673828125 2.89263916015625 C 2.6690673828125 2.89263916015625 2.79998779296875 2.899993896484375 2.79998779296875 2.899993896484375 C 2.79998779296875 2.899993896484375 2.79998779296875 0.239990234375 2.79998779296875 0.239990234375 C 2.79998779296875 0.239990234375 0.920013427734375 2.118988037109375 0.920013427734375 2.118988037109375 M -0.12591552734375 0.87725830078125 C -0.12591552734375 0.87725830078125 -0.154693603515625 0.969482421875 -0.154693603515625 0.969482421875 C -0.154693603515625 0.969482421875 -0.186309814453125 1.0606689453125 -0.186309814453125 1.0606689453125 C -0.186309814453125 1.0606689453125 -0.220672607421875 1.15069580078125 -0.220672607421875 1.15069580078125 C -0.220672607421875 1.15069580078125 -0.2578125 1.239532470703125 -0.2578125 1.239532470703125 C -0.2578125 1.239532470703125 -0.29766845703125 1.32708740234375 -0.29766845703125 1.32708740234375 C -0.29766845703125 1.32708740234375 -0.340179443359375 1.413330078125 -0.340179443359375 1.413330078125 C -0.340179443359375 1.413330078125 -0.385345458984375 1.498199462890625 -0.385345458984375 1.498199462890625 C -0.385345458984375 1.498199462890625 -0.433135986328125 1.581634521484375 -0.433135986328125 1.581634521484375 C -0.433135986328125 1.581634521484375 -0.4835205078125 1.663543701171875 -0.4835205078125 1.663543701171875 C -0.4835205078125 1.663543701171875 -0.53643798828125 1.743896484375 -0.53643798828125 1.743896484375 C -0.53643798828125 1.743896484375 -0.59185791015625 1.8226318359375 -0.59185791015625 1.8226318359375 C -0.59185791015625 1.8226318359375 -0.649749755859375 1.899658203125 -0.649749755859375 1.899658203125 C -0.649749755859375 1.899658203125 -0.710113525390625 1.974945068359375 -0.710113525390625 1.974945068359375 C -0.710113525390625 1.974945068359375 -0.772857666015625 2.04840087890625 -0.772857666015625 2.04840087890625 C -0.772857666015625 2.04840087890625 -0.8380126953125 2.1199951171875 -0.8380126953125 2.1199951171875 C -0.8380126953125 2.1199951171875 -0.10101318359375 2.858001708984375 -0.10101318359375 2.858001708984375 C -0.10101318359375 2.858001708984375 -0.100006103515625 2.858001708984375 -0.100006103515625 2.858001708984375 C -0.100006103515625 2.858001708984375 0.63800048828125 2.118988037109375 0.63800048828125 2.118988037109375 C 0.63800048828125 2.118988037109375 0.5728759765625 2.047454833984375 0.5728759765625 2.047454833984375 C 0.5728759765625 2.047454833984375 0.510162353515625 1.974029541015625 0.510162353515625 1.974029541015625 C 0.510162353515625 1.974029541015625 0.4498291015625 1.8988037109375 0.4498291015625 1.8988037109375 C 0.4498291015625 1.8988037109375 0.391937255859375 1.82183837890625 0.391937255859375 1.82183837890625 C 0.391937255859375 1.82183837890625 0.336517333984375 1.743194580078125 0.336517333984375 1.743194580078125 C 0.336517333984375 1.743194580078125 0.283599853515625 1.66290283203125 0.283599853515625 1.66290283203125 C 0.283599853515625 1.66290283203125 0.233245849609375 1.581024169921875 0.233245849609375 1.581024169921875 C 0.233245849609375 1.581024169921875 0.185455322265625 1.4976806640625 0.185455322265625 1.4976806640625 C 0.185455322265625 1.4976806640625 0.140289306640625 1.412872314453125 0.140289306640625 1.412872314453125 C 0.140289306640625 1.412872314453125 0.097747802734375 1.326690673828125 0.097747802734375 1.326690673828125 C 0.097747802734375 1.326690673828125 0.057891845703125 1.23919677734375 0.057891845703125 1.23919677734375 C 0.057891845703125 1.23919677734375 0.020751953125 1.150421142578125 0.020751953125 1.150421142578125 C 0.020751953125 1.150421142578125 -0.013641357421875 1.060455322265625 -0.013641357421875 1.060455322265625 C -0.013641357421875 1.060455322265625 -0.045257568359375 0.9693603515625 -0.045257568359375 0.9693603515625 C -0.045257568359375 0.9693603515625 -0.07403564453125 0.877197265625 -0.07403564453125 0.877197265625 C -0.07403564453125 0.877197265625 -0.100006103515625 0.78399658203125 -0.100006103515625 0.78399658203125 C -0.100006103515625 0.78399658203125 -0.12591552734375 0.87725830078125 -0.12591552734375 0.87725830078125 M -2.8590087890625 0.100006103515625 C -2.8590087890625 0.100006103515625 -0.979522705078125 1.9794921875 -0.979522705078125 1.9794921875 C -0.979522705078125 1.9794921875 -0.89263916015625 1.88226318359375 -0.89263916015625 1.88226318359375 C -0.89263916015625 1.88226318359375 -0.810089111328125 1.781036376953125 -0.810089111328125 1.781036376953125 C -0.810089111328125 1.781036376953125 -0.732421875 1.676513671875 -0.732421875 1.676513671875 C -0.732421875 1.676513671875 -0.65972900390625 1.568878173828125 -0.65972900390625 1.568878173828125 C -0.65972900390625 1.568878173828125 -0.592071533203125 1.458282470703125 -0.592071533203125 1.458282470703125 C -0.592071533203125 1.458282470703125 -0.529510498046875 1.344940185546875 -0.529510498046875 1.344940185546875 C -0.529510498046875 1.344940185546875 -0.47216796875 1.229034423828125 -0.47216796875 1.229034423828125 C -0.47216796875 1.229034423828125 -0.420074462890625 1.1107177734375 -0.420074462890625 1.1107177734375 C -0.420074462890625 1.1107177734375 -0.37335205078125 0.990203857421875 -0.37335205078125 0.990203857421875 C -0.37335205078125 0.990203857421875 -0.332000732421875 0.86767578125 -0.332000732421875 0.86767578125 C -0.332000732421875 0.86767578125 -0.296173095703125 0.7432861328125 -0.296173095703125 0.7432861328125 C -0.296173095703125 0.7432861328125 -0.265899658203125 0.617218017578125 -0.265899658203125 0.617218017578125 C -0.265899658203125 0.617218017578125 -0.24127197265625 0.48968505859375 -0.24127197265625 0.48968505859375 C -0.24127197265625 0.48968505859375 -0.22235107421875 0.36083984375 -0.22235107421875 0.36083984375 C -0.22235107421875 0.36083984375 -0.209259033203125 0.23089599609375 -0.209259033203125 0.23089599609375 C -0.209259033203125 0.23089599609375 -0.201995849609375 0.100006103515625 -0.201995849609375 0.100006103515625 C -0.201995849609375 0.100006103515625 -2.8590087890625 0.100006103515625 -2.8590087890625 0.100006103515625 M 0.00201416015625 0.100006103515625 C 0.00201416015625 0.100006103515625 0.009246826171875 0.230804443359375 0.009246826171875 0.230804443359375 C 0.009246826171875 0.230804443359375 0.0223388671875 0.36065673828125 0.0223388671875 0.36065673828125 C 0.0223388671875 0.36065673828125 0.041229248046875 0.489410400390625 0.041229248046875 0.489410400390625 C 0.041229248046875 0.489410400390625 0.065826416015625 0.61688232421875 0.065826416015625 0.61688232421875 C 0.065826416015625 0.61688232421875 0.096038818359375 0.74285888671875 0.096038818359375 0.74285888671875 C 0.096038818359375 0.74285888671875 0.1318359375 0.867156982421875 0.1318359375 0.867156982421875 C 0.1318359375 0.867156982421875 0.173095703125 0.989654541015625 0.173095703125 0.989654541015625 C 0.173095703125 0.989654541015625 0.21978759765625 1.110076904296875 0.21978759765625 1.110076904296875 C 0.21978759765625 1.110076904296875 0.271820068359375 1.22833251953125 0.271820068359375 1.22833251953125 C 0.271820068359375 1.22833251953125 0.3291015625 1.34417724609375 0.3291015625 1.34417724609375 C 0.3291015625 1.34417724609375 0.39154052734375 1.457489013671875 0.39154052734375 1.457489013671875 C 0.39154052734375 1.457489013671875 0.459136962890625 1.5679931640625 0.459136962890625 1.5679931640625 C 0.459136962890625 1.5679931640625 0.53173828125 1.67559814453125 0.53173828125 1.67559814453125 C 0.53173828125 1.67559814453125 0.609283447265625 1.78009033203125 0.609283447265625 1.78009033203125 C 0.609283447265625 1.78009033203125 0.691741943359375 1.88128662109375 0.691741943359375 1.88128662109375 C 0.691741943359375 1.88128662109375 0.77899169921875 1.97900390625 0.77899169921875 1.97900390625 C 0.77899169921875 1.97900390625 2.657989501953125 0.100006103515625 2.657989501953125 0.100006103515625 C 2.657989501953125 0.100006103515625 0.00201416015625 0.100006103515625 0.00201416015625 0.100006103515625 M -2.8590087890625 -0.100006103515625 C -2.8590087890625 -0.100006103515625 -0.201995849609375 -0.100006103515625 -0.201995849609375 -0.100006103515625 C -0.201995849609375 -0.100006103515625 -0.209259033203125 -0.23089599609375 -0.209259033203125 -0.23089599609375 C -0.209259033203125 -0.23089599609375 -0.22235107421875 -0.36083984375 -0.22235107421875 -0.36083984375 C -0.22235107421875 -0.36083984375 -0.24127197265625 -0.48968505859375 -0.24127197265625 -0.48968505859375 C -0.24127197265625 -0.48968505859375 -0.265899658203125 -0.617218017578125 -0.265899658203125 -0.617218017578125 C -0.265899658203125 -0.617218017578125 -0.296173095703125 -0.7432861328125 -0.296173095703125 -0.7432861328125 C -0.296173095703125 -0.7432861328125 -0.332000732421875 -0.86767578125 -0.332000732421875 -0.86767578125 C -0.332000732421875 -0.86767578125 -0.37335205078125 -0.990203857421875 -0.37335205078125 -0.990203857421875 C -0.37335205078125 -0.990203857421875 -0.420074462890625 -1.1107177734375 -0.420074462890625 -1.1107177734375 C -0.420074462890625 -1.1107177734375 -0.47216796875 -1.229034423828125 -0.47216796875 -1.229034423828125 C -0.47216796875 -1.229034423828125 -0.529510498046875 -1.344940185546875 -0.529510498046875 -1.344940185546875 C -0.529510498046875 -1.344940185546875 -0.592071533203125 -1.458282470703125 -0.592071533203125 -1.458282470703125 C -0.592071533203125 -1.458282470703125 -0.65972900390625 -1.568878173828125 -0.65972900390625 -1.568878173828125 C -0.65972900390625 -1.568878173828125 -0.732421875 -1.676513671875 -0.732421875 -1.676513671875 C -0.732421875 -1.676513671875 -0.810089111328125 -1.781036376953125 -0.810089111328125 -1.781036376953125 C -0.810089111328125 -1.781036376953125 -0.89263916015625 -1.88226318359375 -0.89263916015625 -1.88226318359375 C -0.89263916015625 -1.88226318359375 -0.979522705078125 -1.9794921875 -0.979522705078125 -1.9794921875 C -0.979522705078125 -1.9794921875 -2.8590087890625 -0.100006103515625 -2.8590087890625 -0.100006103515625 M 0.691741943359375 -1.88128662109375 C 0.691741943359375 -1.88128662109375 0.609283447265625 -1.78009033203125 0.609283447265625 -1.78009033203125 C 0.609283447265625 -1.78009033203125 0.53173828125 -1.67559814453125 0.53173828125 -1.67559814453125 C 0.53173828125 -1.67559814453125 0.459136962890625 -1.5679931640625 0.459136962890625 -1.5679931640625 C 0.459136962890625 -1.5679931640625 0.39154052734375 -1.457489013671875 0.39154052734375 -1.457489013671875 C 0.39154052734375 -1.457489013671875 0.3291015625 -1.34417724609375 0.3291015625 -1.34417724609375 C 0.3291015625 -1.34417724609375 0.271820068359375 -1.22833251953125 0.271820068359375 -1.22833251953125 C 0.271820068359375 -1.22833251953125 0.21978759765625 -1.110076904296875 0.21978759765625 -1.110076904296875 C 0.21978759765625 -1.110076904296875 0.173095703125 -0.989654541015625 0.173095703125 -0.989654541015625 C 0.173095703125 -0.989654541015625 0.1318359375 -0.867156982421875 0.1318359375 -0.867156982421875 C 0.1318359375 -0.867156982421875 0.096038818359375 -0.74285888671875 0.096038818359375 -0.74285888671875 C 0.096038818359375 -0.74285888671875 0.065826416015625 -0.61688232421875 0.065826416015625 -0.61688232421875 C 0.065826416015625 -0.61688232421875 0.041229248046875 -0.489410400390625 0.041229248046875 -0.489410400390625 C 0.041229248046875 -0.489410400390625 0.0223388671875 -0.36065673828125 0.0223388671875 -0.36065673828125 C 0.0223388671875 -0.36065673828125 0.009246826171875 -0.230804443359375 0.009246826171875 -0.230804443359375 C 0.009246826171875 -0.230804443359375 0.00201416015625 -0.100006103515625 0.00201416015625 -0.100006103515625 C 0.00201416015625 -0.100006103515625 2.657989501953125 -0.100006103515625 2.657989501953125 -0.100006103515625 C 2.657989501953125 -0.100006103515625 0.77899169921875 -1.97900390625 0.77899169921875 -1.97900390625 C 0.77899169921875 -1.97900390625 0.691741943359375 -1.88128662109375 0.691741943359375 -1.88128662109375 M 2.6690673828125 -2.89263916015625 C 2.6690673828125 -2.89263916015625 2.5390625 -2.879425048828125 2.5390625 -2.879425048828125 C 2.5390625 -2.879425048828125 2.410186767578125 -2.86041259765625 2.410186767578125 -2.86041259765625 C 2.410186767578125 -2.86041259765625 2.282623291015625 -2.835662841796875 2.282623291015625 -2.835662841796875 C 2.282623291015625 -2.835662841796875 2.15655517578125 -2.805267333984375 2.15655517578125 -2.805267333984375 C 2.15655517578125 -2.805267333984375 2.032135009765625 -2.769317626953125 2.032135009765625 -2.769317626953125 C 2.032135009765625 -2.769317626953125 1.909576416015625 -2.72784423828125 1.909576416015625 -2.72784423828125 C 1.909576416015625 -2.72784423828125 1.7890625 -2.68096923828125 1.7890625 -2.68096923828125 C 1.7890625 -2.68096923828125 1.670745849609375 -2.628753662109375 1.670745849609375 -2.628753662109375 C 1.670745849609375 -2.628753662109375 1.554840087890625 -2.5712890625 1.554840087890625 -2.5712890625 C 1.554840087890625 -2.5712890625 1.4415283203125 -2.50860595703125 1.4415283203125 -2.50860595703125 C 1.4415283203125 -2.50860595703125 1.330963134765625 -2.440826416015625 1.330963134765625 -2.440826416015625 C 1.330963134765625 -2.440826416015625 1.223358154296875 -2.36798095703125 1.223358154296875 -2.36798095703125 C 1.223358154296875 -2.36798095703125 1.118865966796875 -2.290191650390625 1.118865966796875 -2.290191650390625 C 1.118865966796875 -2.290191650390625 1.017669677734375 -2.207489013671875 1.017669677734375 -2.207489013671875 C 1.017669677734375 -2.207489013671875 0.920013427734375 -2.1199951171875 0.920013427734375 -2.1199951171875 C 0.920013427734375 -2.1199951171875 0.920013427734375 -2.118988037109375 0.920013427734375 -2.118988037109375 C 0.920013427734375 -2.118988037109375 2.79998779296875 -0.239990234375 2.79998779296875 -0.239990234375 C 2.79998779296875 -0.239990234375 2.79998779296875 -2.899993896484375 2.79998779296875 -2.899993896484375 C 2.79998779296875 -2.899993896484375 2.6690673828125 -2.89263916015625 2.6690673828125 -2.89263916015625 M -0.10101318359375 -2.858001708984375 C -0.10101318359375 -2.858001708984375 -0.8380126953125 -2.1199951171875 -0.8380126953125 -2.1199951171875 C -0.8380126953125 -2.1199951171875 -0.772857666015625 -2.04840087890625 -0.772857666015625 -2.04840087890625 C -0.772857666015625 -2.04840087890625 -0.710113525390625 -1.974945068359375 -0.710113525390625 -1.974945068359375 C -0.710113525390625 -1.974945068359375 -0.649749755859375 -1.899658203125 -0.649749755859375 -1.899658203125 C -0.649749755859375 -1.899658203125 -0.59185791015625 -1.8226318359375 -0.59185791015625 -1.8226318359375 C -0.59185791015625 -1.8226318359375 -0.53643798828125 -1.743896484375 -0.53643798828125 -1.743896484375 C -0.53643798828125 -1.743896484375 -0.4835205078125 -1.663543701171875 -0.4835205078125 -1.663543701171875 C -0.4835205078125 -1.663543701171875 -0.433135986328125 -1.581634521484375 -0.433135986328125 -1.581634521484375 C -0.433135986328125 -1.581634521484375 -0.385345458984375 -1.498199462890625 -0.385345458984375 -1.498199462890625 C -0.385345458984375 -1.498199462890625 -0.340179443359375 -1.413330078125 -0.340179443359375 -1.413330078125 C -0.340179443359375 -1.413330078125 -0.29766845703125 -1.32708740234375 -0.29766845703125 -1.32708740234375 C -0.29766845703125 -1.32708740234375 -0.2578125 -1.239532470703125 -0.2578125 -1.239532470703125 C -0.2578125 -1.239532470703125 -0.220672607421875 -1.15069580078125 -0.220672607421875 -1.15069580078125 C -0.220672607421875 -1.15069580078125 -0.186309814453125 -1.0606689453125 -0.186309814453125 -1.0606689453125 C -0.186309814453125 -1.0606689453125 -0.154693603515625 -0.969482421875 -0.154693603515625 -0.969482421875 C -0.154693603515625 -0.969482421875 -0.12591552734375 -0.87725830078125 -0.12591552734375 -0.87725830078125 C -0.12591552734375 -0.87725830078125 -0.100006103515625 -0.78399658203125 -0.100006103515625 -0.78399658203125 C -0.100006103515625 -0.78399658203125 -0.07403564453125 -0.877197265625 -0.07403564453125 -0.877197265625 C -0.07403564453125 -0.877197265625 -0.045257568359375 -0.9693603515625 -0.045257568359375 -0.9693603515625 C -0.045257568359375 -0.9693603515625 -0.013641357421875 -1.060455322265625 -0.013641357421875 -1.060455322265625 C -0.013641357421875 -1.060455322265625 0.020751953125 -1.150421142578125 0.020751953125 -1.150421142578125 C 0.020751953125 -1.150421142578125 0.057891845703125 -1.23919677734375 0.057891845703125 -1.23919677734375 C 0.057891845703125 -1.23919677734375 0.097747802734375 -1.326690673828125 0.097747802734375 -1.326690673828125 C 0.097747802734375 -1.326690673828125 0.140289306640625 -1.412872314453125 0.140289306640625 -1.412872314453125 C 0.140289306640625 -1.412872314453125 0.185455322265625 -1.4976806640625 0.185455322265625 -1.4976806640625 C 0.185455322265625 -1.4976806640625 0.233245849609375 -1.581024169921875 0.233245849609375 -1.581024169921875 C 0.233245849609375 -1.581024169921875 0.283599853515625 -1.66290283203125 0.283599853515625 -1.66290283203125 C 0.283599853515625 -1.66290283203125 0.336517333984375 -1.743194580078125 0.336517333984375 -1.743194580078125 C 0.336517333984375 -1.743194580078125 0.391937255859375 -1.82183837890625 0.391937255859375 -1.82183837890625 C 0.391937255859375 -1.82183837890625 0.4498291015625 -1.8988037109375 0.4498291015625 -1.8988037109375 C 0.4498291015625 -1.8988037109375 0.510162353515625 -1.974029541015625 0.510162353515625 -1.974029541015625 C 0.510162353515625 -1.974029541015625 0.5728759765625 -2.047454833984375 0.5728759765625 -2.047454833984375 C 0.5728759765625 -2.047454833984375 0.63800048828125 -2.118988037109375 0.63800048828125 -2.118988037109375 C 0.63800048828125 -2.118988037109375 -0.100006103515625 -2.858001708984375 -0.100006103515625 -2.858001708984375 C -0.100006103515625 -2.858001708984375 -0.10101318359375 -2.858001708984375 -0.10101318359375 -2.858001708984375';
    
    // Define a properties array that returns array of objects representing
    // the accepted properties for your application
    var properties = function(args) {
      var material = args.material;
      var materialHeight = material.dimensions.z;
      var selectedVolumes = getSelectedVolumes(args.volumes, args.selectedVolumeIds);
      targetVolume = selectedVolumes[0];
      
			var texturelist = [];
			for( var t in textures) {
			  texturelist.push(t);
			}
      
      var props = [
        {type: 'list', id: "Texture", value: texturelist[0], options: texturelist},
        {type: 'text', id: "Custom Pattern", value: ""},
        {type: 'boolean', id: "Randomize", value: false},
        {type: 'range', id: "Scale X", value: 1, min: 0.1, max: 10, step: .1},
        {type: 'boolean', id: "Scale Y = Scale X", value: true},
        {type: 'range', id: "Scale Y", value: 1, min: 0.1, max: 10, step: .1},
        {type: 'range', id: "X Translate", value: 0, min: -50, max: 50},
        {type: 'range', id: "Y Translate", value: 0, min: -50, max: 50},
        {type: 'range', id: "X Padding", value: 0, min: -50, max: 200},
        {type: 'range', id: "Y Padding", value: 0, min: -50, max: 200},
        {type: 'range', id: "Texture Offset", value: 0, min: -.1, max: .1, step: 0.001},
        {type: 'range', id: "Texture Margin", value: 0, min: 0, max: 1, step: 0.001},
        {type: 'range', id: "Source Depth", value: 0, min:0, max:material.dimensions.z, step:0.001},
        {type: 'range', id: "Texture Depth", value: material.dimensions.z, min:0, max:material.dimensions.z, step:0.001}
      ];
      
      return props;
    };

    // Define an executor function that builds an array of volumes,
    // and passes it to the provided success callback, or invokes the failure
    // callback if unable to do so
    var executor = function(args, success, failure) {
      clearTimeout(timeout);
      timeout = setTimeout(function () {
        executor2(args, success, failure);
      }, 500);
    }
    
    var executor2 = function(args, success, failure) {
      var params = args.params;
      var material = args.material;
      
      var selectedVolumes = getSelectedVolumes(args.volumes, args.selectedVolumeIds);
      if(selectedVolumes.length > 1) {failure("Please select only 1 shape."); return false;}
      
      var pathData = textures[params["Texture"]];
      if(params["Custom Pattern"] !== "") {pathData = params["Custom Pattern"];}
      if(params["Scale Y = Scale X"]) {params["Scale Y"] = params["Scale X"];}
      
      params["Source Depth"] = Math.max(Math.min(params["Source Depth"], material.dimensions.z), 0);
      params["Texture Depth"] = Math.max(Math.min(params["Texture Depth"], material.dimensions.z), 0);
      
      var volumes_pattern = [];
      var volumes = [];
      
      var cPoints = EASEL.pathToControlPoints(EASEL.pathStringParser.parse(pathData));
      var pathVolume = EASEL.pathUtils.fromPointArrays(cPoints);
      var path_bb = EASEL.volumeHelper.boundingBox([pathVolume]);
      targetVolume.cut.depth = params["Source Depth"];
      var cutObj = { depth: params["Texture Depth"], type: 'fill', outlineStyle: 'on-path', tabPreference: false };
      
      var X_Padding = path_bb.width * params["X Padding"] / 100;
      var Y_Padding = path_bb.height * params["Y Padding"] / 100;
      
      var pattern_cols = Math.ceil(targetVolume.shape.width / ((path_bb.width + X_Padding) * params["Scale X"])) + 2;
      var pattern_rows = Math.ceil(targetVolume.shape.height / ((path_bb.height + Y_Padding) * params["Scale Y"])) + 2;
      
      for(var i = 0; i < pattern_cols; i++) {
        for(var j = 0; j < pattern_rows; j++) {
          var vol_clone = JSON.parse(JSON.stringify(pathVolume));
          vol_clone.shape.center.x = (pathVolume.shape.width + X_Padding) * (i - 1);
          vol_clone.shape.center.y = (pathVolume.shape.height + Y_Padding) * (j - 1);
          if(params["Randomize"]) {
            var angle = (Math.PI / 2) * Math.floor(Math.random() * 3);
            vol_clone.shape.rotation = angle;
          }
          volumes_pattern.push(vol_clone);
        }
      }
      
      // ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3}
      
      var target_bb = EASEL.volumeHelper.boundingBox(selectedVolumes);
      var volume_texture = EASEL.volumeHelper.intersect(volumes_pattern, volumes_pattern, 1);
      var texture_bb = EASEL.volumeHelper.boundingBox([volume_texture]);
      volume_texture.shape.width  *= params["Scale X"];
      volume_texture.shape.height *= params["Scale Y"];
      volume_texture.shape.center.x = targetVolume.shape.center.x + (pathVolume.shape.width * params["Scale X"] * params["X Translate"] / 100);
      volume_texture.shape.center.y = targetVolume.shape.center.y + (pathVolume.shape.height * params["Scale Y"] * params["Y Translate"] / 100);
      
      var volume_offset = EASEL.volumeHelper.expand([volume_texture], params["Texture Offset"]);
      
      var target_offset = EASEL.volumeHelper.expand([selectedVolumes[0]], params["Texture Margin"] * -1);
      
      var volume_textured = EASEL.volumeHelper.intersect([target_offset], [volume_offset], 0);
      //volume_textured.shape.center.x = targetVolume.shape.center.x;
      //volume_textured.shape.center.y = targetVolume.shape.center.y;
      volume_textured.cut = cutObj;
      volumes = [targetVolume, volume_textured];
      
      
      //console.log(volume_offset);
      
      success(volumes);
    };
